<div class="add-position-dialog">
  <h2>Manage Position</h2>

  <div *ngIf="error" class="error-message">{{ error }}</div>

  <form [formGroup]="positionForm" (ngSubmit)="onSubmit()">
    <mat-form-field appearance="outline">
      <mat-label>Stock Name</mat-label>
      <input
        matInput
        formControlName="stockName"
        placeholder="Enter stock name"
        required
      />
      <mat-error *ngIf="positionForm.get('stockName')?.hasError('required')">
        Stock name is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Ticker Symbol</mat-label>
      <input
        matInput
        formControlName="tickerSymbol"
        placeholder="Enter ticker symbol"
        required
      />
      <mat-error *ngIf="positionForm.get('tickerSymbol')?.hasError('required')">
        Ticker symbol is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Number of Shares</mat-label>
      <input
        matInput
        type="number"
        formControlName="numberOfShares"
        placeholder="Enter number of shares"
        required
        min="0.01"
        step="0.01"
      />
      <mat-error
        *ngIf="positionForm.get('numberOfShares')?.hasError('required')"
      >
        Number of shares is required
      </mat-error>
      <mat-error *ngIf="positionForm.get('numberOfShares')?.hasError('min')">
        Number of shares must be greater than 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Purchase Price</mat-label>
      <input
        matInput
        type="number"
        formControlName="priceAtPurchase"
        placeholder="Enter purchase price"
        required
        min="0.01"
        step="0.01"
      />
      <mat-error
        *ngIf="positionForm.get('priceAtPurchase')?.hasError('required')"
      >
        Purchase price is required
      </mat-error>
      <mat-error *ngIf="positionForm.get('priceAtPurchase')?.hasError('min')">
        Purchase price must be greater than 0
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Date of Acquisition</mat-label>
      <input
        matInput
        [matDatepicker]="picker"
        formControlName="dateOfAcquisition"
        [max]="maxDate"
        placeholder="Choose a date"
        required
        readonly
      />
      <mat-hint>MM/DD/YYYY</mat-hint>
      <mat-datepicker-toggle matIconSuffix [for]="picker">
        <mat-icon matDatepickerToggleIcon>calendar_today</mat-icon>
      </mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      <mat-error
        *ngIf="positionForm.get('dateOfAcquisition')?.hasError('required')"
      >
        Date is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Type</mat-label>
      <mat-select formControlName="type" required>
        <mat-option value="buy">Buy</mat-option>
        <mat-option value="sell">Sell</mat-option>
      </mat-select>
      <mat-error *ngIf="positionForm.get('type')?.hasError('required')">
        Type is required
      </mat-error>
    </mat-form-field>

    <div class="dialog-actions">
      <button mat-stroked-button type="button" (click)="onCancel()">
        Cancel
      </button>
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="!positionForm.valid || isLoading"
      >
        {{ isLoading ? 'Adding...' : 'Add Position' }}
      </button>
    </div>
  </form>
</div>
